# 1. Preparing the environment

In order to ease the workshop we have created a CloudFormation Stack that deploys the following assets:

- A S3 bucket used for SAM deployments.
- A S3 public web site bucket to host the frontend application.
- A bucket policy for the previous bucket.
- An IAM Role used by **CodeBuild** to access assests generated by SAM, receive and deliver messages from CodePipeline and execute CloudFormation actions.
- An IAM Role used by CloudFormation to deploy all the assets of the application.

## 1.1. Environment CloudFormation.

### 1.1.1: Deploy the Step 0 CloudFormation Stack.

To deploy these assets go to the step0 folder and find the follwing file:

<img src="../images/0_cloudformation_stack.png" />

1. Go to the **CloudFormation** Console and click on create a new stack.
2. Write the Stack name **ServerlessOps-step0-stack** your **Alias** and click continue.
3. Once you are in the final option page, enable CloudFormation to create IAM resources:

<img src="../images/0_cloudformation_iam_permissions.png" />

## 1.2: Change the buildspec.yaml to add S3 deployments.

The CloudFormation stack will create an S3 bucket for deployments with the following 

```
serverlessops-deploymentbucket-<your-alias-here>
```

Within the code, go to `buildspec.yaml` and change the S3 bucket to the one you have just created. Basically, add the alias you added to the CloudFormation here.

## 1.3. Review swagger

Now, the application consists on an API, Lambda and Rekognition to get the tags of a photo. A key element on this application is the API which is defined by a swagger template called **swagger.yaml**.

Go to that file and and change the line 23 which cotains:

```yaml

uri: arn:aws:apigateway:<region>:lambda:path/2015-03-31/functions/arn:aws:lambda:<region>:<AccountID>:function:${stageVariables.LambdaFunctionName}:live/invocations

```

Here you have to change `<region>` and `<AccountId>`with the region you're deploying in and the account Id you are using.

## 1.4. Upload your web page

During the course of this workshop we will use this web page as the application we will be changing over time. In this case, upload all the content under *frontend* to the S3 bucket created by **step 1.1.1**. 

You can use this command once you are within the *frontend* folder:

```bash
aws s3 cp . s3://ServerlessOps-step0-stack-serverlessopsfrontend-<random-string>
```

Of course, you need to change <random-string> with your actual bucket.

Once you have finished this step you can start the second step [here](../../documentation/2_develop_with_cloud9).
